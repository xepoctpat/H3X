<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>H3X Imagine-to-Create Interface</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f6f8fa; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 32px; }
    h1 { color: #2b3a4b; }
    label { display: block; margin-top: 18px; font-weight: bold; }
    textarea, input, select { width: 100%; padding: 10px; margin-top: 6px; border-radius: 5px; border: 1px solid #ccc; font-size: 1em; }
    button { margin-top: 24px; padding: 12px 32px; background: #2b3a4b; color: #fff; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; }
    button:disabled { background: #aaa; }
    .result, .ui-dynamic, .suggestions, .movement { margin-top: 32px; padding: 18px; background: #f0f4f8; border-radius: 8px; }
    .ui-dynamic label { margin-top: 8px; }
    .suggestion-btn { margin: 6px 6px 0 0; padding: 8px 18px; background: #4b7bec; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    .movement-param { margin-bottom: 8px; }
    .small { font-size: 0.95em; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>H3X Imagine-to-Create</h1>
    <form id="imagineForm">
      <label for="imagination">Imagination (tekst, JSON, ili scenario):</label>
      <textarea id="imagination" rows="4" required placeholder='npr: { "type": "interactive", "prompt": "Kreiraj asistenta", ... }'></textarea>
      <label for="generationType">Tip generacije (opciono):</label>
      <input id="generationType" placeholder="npr: ai_assistant, movement, proactive, ...">
      <button type="submit">Pošalji imaginaciju</button>
    </form>
    <div id="dynamicUI" class="ui-dynamic"></div>
    <div id="suggestions" class="suggestions"></div>
    <div id="movement" class="movement"></div>
    <div id="result" class="result"></div>
  </div>
  <script>
    const form = document.getElementById('imagineForm');
    const resultDiv = document.getElementById('result');
    const dynamicUI = document.getElementById('dynamicUI');
    const suggestionsDiv = document.getElementById('suggestions');
    const movementDiv = document.getElementById('movement');

    function clearAll() {
      resultDiv.innerHTML = '';
      dynamicUI.innerHTML = '';
      suggestionsDiv.innerHTML = '';
      movementDiv.innerHTML = '';
    }

    form.onsubmit = async (e) => {
      e.preventDefault();
      clearAll();
      let imagination, generationType;
      try {
        imagination = JSON.parse(document.getElementById('imagination').value);
      } catch {
        imagination = document.getElementById('imagination').value;
      }
      generationType = document.getElementById('generationType').value;
      const body = { imagination };
      if (generationType) body.generationType = generationType;
      const res = await fetch('/imagine-to-create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      if (!data.success) {
        resultDiv.innerHTML = `<b>Greška:</b> ${data.error || 'Nepoznata greška.'}`;
        return;
      }
      // Interaktivni UI
      if (data.uiSchema && data.generationType === 'interactive') {
        renderDynamicUI(data.uiSchema, data.actions);
        resultDiv.innerHTML = `<span class="small">Interaktivni režim: popuni polja i klikni akciju.</span>`;
      }
      // Proaktivni predlozi
      else if (data.proactiveSuggestions && data.generationType === 'proactive') {
        renderSuggestions(data.proactiveSuggestions);
        resultDiv.innerHTML = `<span class="small">Proaktivni režim: izaberi predlog za sledeću akciju.</span>`;
      }
      // Scenario kretanja
      else if (data.movementInstructions && data.generationType === 'movement') {
        renderMovement(data.movementInstructions);
        resultDiv.innerHTML = `<span class="small">Scenario kretanja: parametri prikazani ispod.</span>`;
      }
      // Klasičan rezultat
      else if (data.result) {
        resultDiv.innerHTML = `<b>Rezultat:</b><pre>${JSON.stringify(data.result, null, 2)}</pre>`;
      } else {
        resultDiv.innerHTML = `<b>Odgovor:</b><pre>${JSON.stringify(data, null, 2)}</pre>`;
      }
    };

    function renderDynamicUI(uiSchema, actions) {
      dynamicUI.innerHTML = '';
      if (!uiSchema.fields) return;
      const form = document.createElement('form');
      uiSchema.fields.forEach(field => {
        const label = document.createElement('label');
        label.textContent = field.label || field.name;
        const input = document.createElement(field.type === 'dropdown' ? 'select' : 'input');
        input.name = field.name;
        if (field.type === 'dropdown' && field.options) {
          field.options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt;
            option.textContent = opt;
            input.appendChild(option);
          });
        } else {
          input.type = field.type || 'text';
        }
        form.appendChild(label);
        form.appendChild(input);
      });
      if (actions && actions.length) {
        actions.forEach(action => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'suggestion-btn';
          btn.textContent = action.label || action.type;
          btn.onclick = async () => {
            const params = {};
            Array.from(form.elements).forEach(el => {
              if (el.name) params[el.name] = el.value;
            });
            // Pošalji ponovo sa parametrima
            const imagination = JSON.parse(document.getElementById('imagination').value);
            const body = { imagination, parameters: params };
            if (document.getElementById('generationType').value)
              body.generationType = document.getElementById('generationType').value;
            const res = await fetch('/imagine-to-create', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body)
            });
            const data = await res.json();
            resultDiv.innerHTML = `<b>Rezultat:</b><pre>${JSON.stringify(data.result || data, null, 2)}</pre>`;
          };
          form.appendChild(btn);
        });
      }
      dynamicUI.appendChild(form);
    }

    function renderSuggestions(suggestions) {
      suggestionsDiv.innerHTML = '<b>Predlozi:</b><br>';
      suggestions.forEach(s => {
        const btn = document.createElement('button');
        btn.className = 'suggestion-btn';
        btn.textContent = s.label || s.action;
        btn.onclick = async () => {
          // Pošalji imaginaciju sa izabranom akcijom kao parametar
          const imagination = JSON.parse(document.getElementById('imagination').value);
          const body = { imagination, parameters: { action: s.action } };
          if (document.getElementById('generationType').value)
            body.generationType = document.getElementById('generationType').value;
          const res = await fetch('/imagine-to-create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          });
          const data = await res.json();
          resultDiv.innerHTML = `<b>Rezultat:</b><pre>${JSON.stringify(data.result || data, null, 2)}</pre>`;
        };
        suggestionsDiv.appendChild(btn);
      });
    }

    function renderMovement(movement) {
      movementDiv.innerHTML = '<b>Parametri kretanja:</b><br>';
      Object.entries(movement).forEach(([k, v]) => {
        const div = document.createElement('div');
        div.className = 'movement-param';
        div.innerHTML = `<b>${k}:</b> ${v}`;
        movementDiv.appendChild(div);
      });
    }
  </script>
</body>
</html>
